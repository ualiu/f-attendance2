<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports - Felton Brushes</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../partials/header') %>
  <%- include('../partials/sidebar') %>

  <main class="main-with-sidebar">
    <h1>Generate AI-Powered Reports</h1>
    <p class="subtitle">Use Claude AI to analyze attendance patterns and get actionable insights</p>

    <div class="reports-grid">
      <!-- Employee Report -->
      <div class="report-card">
        <h2>Individual Employee Report</h2>
        <p>Detailed analysis for a specific employee including attendance patterns and recommendations.</p>

        <form action="/reports/employee" method="POST">
          <div class="form-group">
            <label>Select Employee</label>
            <select name="employeeId" required>
              <option value="">Choose employee...</option>
              <% employees.forEach(emp => { %>
                <option value="<%= emp._id %>">
                  <%= emp.name %> (<%= emp.points_current_quarter %> pts)
                </option>
              <% }); %>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Start Date</label>
              <input type="date" name="startDate" required value="<%= new Date(Date.now() - 90*24*60*60*1000).toISOString().split('T')[0] %>">
            </div>
            <div class="form-group">
              <label>End Date</label>
              <input type="date" name="endDate" required value="<%= new Date().toISOString().split('T')[0] %>">
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Generate Employee Report</button>
        </form>
      </div>

      <!-- Team Report -->
      <div class="report-card">
        <h2>Team Report</h2>
        <p>Overview of all employees, attendance trends, and priority concerns.</p>

        <form action="/reports/team" method="POST">
          <div class="form-row">
            <div class="form-group">
              <label>Start Date</label>
              <input type="date" name="startDate" required value="<%= new Date(Date.now() - 90*24*60*60*1000).toISOString().split('T')[0] %>">
            </div>
            <div class="form-group">
              <label>End Date</label>
              <input type="date" name="endDate" required value="<%= new Date().toISOString().split('T')[0] %>">
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Generate Team Report</button>
        </form>
      </div>

      <!-- Station Report -->
      <div class="report-card">
        <h2>Work Station Downtime Report</h2>
        <p>Analysis of which stations have been most affected by absences.</p>

        <form action="/reports/stations" method="POST">
          <div class="form-group">
            <label>Department (optional)</label>
            <select name="department">
              <option value="">All Departments</option>
              <option value="Production">Production</option>
              <option value="Maintenance">Maintenance</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Start Date</label>
              <input type="date" name="startDate" required value="<%= new Date(Date.now() - 90*24*60*60*1000).toISOString().split('T')[0] %>">
            </div>
            <div class="form-group">
              <label>End Date</label>
              <input type="date" name="endDate" required value="<%= new Date().toISOString().split('T')[0] %>">
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Generate Station Report</button>
        </form>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-reports">
      <h3>Quick Reports</h3>
      <button onclick="setQuarterDates()" class="btn btn-secondary">This Quarter</button>
      <button onclick="setMonthDates()" class="btn btn-secondary">This Month</button>
      <button onclick="setWeekDates()" class="btn btn-secondary">Last 7 Days</button>
    </div>
  </main>

  <script>
    function setQuarterDates() {
      const now = new Date();
      const month = now.getMonth();
      const year = now.getFullYear();
      let quarterStart;

      if (month < 3) quarterStart = new Date(year, 0, 1);
      else if (month < 6) quarterStart = new Date(year, 3, 1);
      else if (month < 9) quarterStart = new Date(year, 6, 1);
      else quarterStart = new Date(year, 9, 1);

      document.querySelectorAll('input[name="startDate"]').forEach(input => {
        input.value = quarterStart.toISOString().split('T')[0];
      });
      document.querySelectorAll('input[name="endDate"]').forEach(input => {
        input.value = now.toISOString().split('T')[0];
      });
    }

    function setMonthDates() {
      const now = new Date();
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

      document.querySelectorAll('input[name="startDate"]').forEach(input => {
        input.value = monthStart.toISOString().split('T')[0];
      });
      document.querySelectorAll('input[name="endDate"]').forEach(input => {
        input.value = now.toISOString().split('T')[0];
      });
    }

    function setWeekDates() {
      const now = new Date();
      const weekAgo = new Date(now.getTime() - 7*24*60*60*1000);

      document.querySelectorAll('input[name="startDate"]').forEach(input => {
        input.value = weekAgo.toISOString().split('T')[0];
      });
      document.querySelectorAll('input[name="endDate"]').forEach(input => {
        input.value = now.toISOString().split('T')[0];
      });
    }
  </script>
</body>
</html>
